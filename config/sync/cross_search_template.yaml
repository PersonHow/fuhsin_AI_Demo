cross_search:
  index_name: erp-cross-search

  settings:
    number_of_shards: 1
    number_of_replicas: 0
    analysis:
      analyzer:
        zh_ik_smart:
          type: custom
          tokenizer: ik_smart
          filter: [lowercase]
        zh_ik_max:
          type: custom
          tokenizer: ik_max_word
          filter: [lowercase]

  mappings:
    dynamic: true
    properties:
      # 來源識別
      source_table: { type: keyword }
      source_id:    { type: keyword }

      # 通用顯示欄位
      title:   { type: text, analyzer: zh_ik_max, search_analyzer: zh_ik_smart }
      summary: { type: text, analyzer: zh_ik_max, search_analyzer: zh_ik_smart }

      # 常見欄位（依你現有 schema）
      company_id:   { type: keyword }
      order_id:     { type: keyword }
      order_date:   { type: date, format: "yyyy-MM-dd||strict_date_optional_time||epoch_millis" }
      created_time: { type: date, format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
      updated_time: { type: date, format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }

      customer_name:    { type: text, analyzer: zh_ik_smart }
      customer_contact: { type: text, analyzer: zh_ik_smart }
      company_name:     { type: text, analyzer: zh_ik_smart }
      item_group:       { type: text, analyzer: zh_ik_smart }
      classification:   { type: text, analyzer: zh_ik_smart }
      processing_type:  { type: text, analyzer: zh_ik_smart }
      specification:    { type: text, analyzer: zh_ik_max }

  templates:
    companies:
      _index: erp-cross-search
      title:  "{{ company_name }}"
      summary: "電話: {{ company_phone }}；地址: {{ company_address }}"
      source_table: "companies"
      source_id: "{{ company_id }}"

    customers:
      _index: erp-cross-search
      title:  "{{ customer_contact }}（{{ company_id }}）"
      summary: "發票地址: {{ invoice_address }}；產業: {{ industry_type }}；備註: {{ remark }}"
      source_table: "customers"
      source_id: "{{ company_id }}"

    orders:
      _index: erp-cross-search
      title:  "{{ order_id }}｜{{ customer_name }}"
      summary: "下單: {{ order_date }}；總計: {{ total_amount }}；狀態: {{ order_status }}"
      source_table: "orders"
      source_id: "{{ order_id }}"

    order_info:
      _index: erp-cross-search
      title:  "{{ order_id }}｜{{ processing_type }}｜{{ classification }}"
      summary: "數量: {{ quantity }}；單價: {{ unit_price }}；小計: {{ subtotal }}"
      source_table: "order_info"
      source_id: "{{ order_detail_id }}"
