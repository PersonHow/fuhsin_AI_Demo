# 要同步的資料表設定
index_template:
  template_name: erp-generic-template
  index_patterns: ["erp-*"]       # 會套用到 erp-companies / erp-orders ... 等
  settings:
    number_of_shards: 1
    number_of_replicas: 0
    analysis:
      analyzer:
        zh_ik_smart:
          type: custom
          tokenizer: ik_smart
          filter: [lowercase]
        zh_ik_max:
          type: custom
          tokenizer: ik_max_word
          filter: [lowercase]
  mappings:
    dynamic: true
    properties:
      created_time: { type: date,  format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
      updated_time: { type: date,  format: "yyyy-MM-dd HH:mm:ss||strict_date_optional_time||epoch_millis" }
      order_date:   { type: date,  format: "yyyy-MM-dd||strict_date_optional_time||epoch_millis" }
      company_id:   { type: keyword }
      order_id:     { type: keyword }
      # 常見中文字串欄位給 IK（表現更好）
      company_name:
        type: text
        analyzer: zh_ik_max
        search_analyzer: zh_ik_smart
      customer_name:
        type: text
        analyzer: zh_ik_max
        search_analyzer: zh_ik_smart

tables:
  # 公司主表（公司/客戶/供應商母表）
  - name: companies
    index_name: erp-companies
    primary_key: company_id
    fields:
      - company_id
      - company_name
      - company_short
      - company_tax_id
      - company_address
      - company_phone
      - company_email
      - company_type     # 1=供應商,2=客戶,3=供應商兼客戶
      - created_time
      - updated_time
    search_fields:
      company_name: 3.0
      company_short: 2.0
      company_tax_id: 1.5

  # 客戶專用欄位表（以 company_id 當主鍵）
  - name: customers
    index_name: erp-customers
    primary_key: company_id
    fields:
      - company_id
      - customer_contact
      - customer_contact_phone
      - invoice_type
      - invoice_address
      - tax_type
      - industry_type
      - customer_tier
      - blacklisted
      - remark
      - created_time
      - updated_time
    search_fields:
      customer_contact: 2.0
      invoice_address: 1.5
      industry_type: 1.2

  # 訂單主表
  - name: orders
    index_name: erp-orders
    primary_key: order_id
    fields:
      - order_id
      - quotation_id
      - quotation_from
      - customer_id
      - customer_name
      - customer_short
      - customer_owner
      - customer_contact
      - customer_address
      - customer_phone
      - customer_email
      - order_date
      - delivery_date
      - order_status
      - total
      - tax
      - total_amount
      - tax_type
      - currency
      - remark
      - created_time
      - updated_time
    search_fields:
      order_id: 3.0
      customer_name: 2.5
      customer_contact: 1.5

  # 訂單明細表
  - name: order_info
    index_name: erp-order-info
    primary_key: order_detail_id
    fields:
      - order_detail_id
      - order_id
      - item_group
      - main_items
      - classification
      - processing_type
      - material_id
      - thickness
      - width
      - length
      - diameter
      - weight
      - quantity
      - unit_price
      - subtotal
      - specification
      - created_time
      - updated_time
    search_fields:
      processing_type: 2.0
      classification: 1.5
      specification: 1.2
